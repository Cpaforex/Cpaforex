<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>پلتفرم LevelUp | داشبورد </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- بارگذاری ethers.js نسخه 6 از CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    <!-- بارگذاری WalletConnect Provider از CDN رسمی -->
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- بارگذاری WalletConnect Handler -->
    <script src="js/walletconnect-handler.js?v=5.7"></script>

  <!-- بارگذاری WalletConnect UMD به صورت لوکال -->
  <script src="js/walletconnect-v1.8.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
</head>
<body>
  <a href="https://levelupwithus.netlify.app/" target="_blank" style="position:fixed;top:18px;left:24px;z-index:2000;display:flex;align-items:center;text-decoration:none;">
    <img src="lvl.jpg" alt="LVL Logo" style="height:48px;width:auto;border-radius:16px;box-shadow:0 2px 12px #00ff8840;transition:transform 0.2s;">
  </a>

  <div id="main-dashboard" class="page-section expandable-container">
    <div class="expand-header">
      <header>
        <h1 class="shimmer-title" style="font-family: 'Montserrat', sans-serif; font-size:2.5rem; letter-spacing:0.12em; color:#222; text-transform:uppercase; font-weight:700; text-shadow:0 2px 12px #00ff8840, 0 1px 0 #fff;">LEVELUP DASHBOARD</h1>
      
      </header>
    </div>
    <div class="expand-content">
      <div class="dashboard-cards" style="display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;max-width:1200px;margin:0 auto;">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">👛</div>
          <div class="dashboard-card-content">
            <div id="dashboard-wallets-count">-WALLET</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">ALL WALLETS</h4>
          </div>
        </div>

        <!-- حذف کارت قیمت LVL (USD) -->
        <!-- حذف کارت قیمت LVL (POL) -->
        <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="circulating-supply">-LVL</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">TOTAL SUPPLY</h4>
      </div>
    </div>
    <!-- کارت total-users (کاربران) حذف شد -->
            <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="total-points">-POINT</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">TOTAL POINTS</h4>
      </div>
    </div>
    <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="point-value">-LVL</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">POINT VALUE</h4>
      </div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-card-icon"></div>
      <div class="dashboard-card-content">
        <div id="contract-token-balance">-LVL</div>
        <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">LVL BALANCE</h4>
      </div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-card-icon"></div>
      <div class="dashboard-card-content">
        <div id="reward-pool">-POL</div>
        <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">POL BALANCE</h4>
      </div>
    </div>
      </div>
    </div>
  </div>

  <!-- Price Chart Section -->
  <div id="price-chart-section" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    <div class="expand-header" style="padding:0 1.5rem;">
      <h2 style="margin:0 0 0.5rem 0;">📈 چارت قیمت‌ها</h2>
      <p style="margin:0 0 0.5rem 0;">نمایش لحظه‌ای قیمت‌های توکن LVL، POL و نرخ تبدیل</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="price-chart-container" style="padding:0;width:100%;">
        <!-- Time Period Filters -->
        <div class="price-chart-time-filters-container" style="margin:0 0 0.5rem 0;">
          <div class="price-chart-time-filters" id="price-chart-time-filters" style="gap:0.2rem;">
            <!-- Time period buttons will be added here by JavaScript -->
          </div>
        </div>
        
        <!-- Line Chart Canvas -->
        <div class="price-chart-canvas-container" style="margin:0;min-width:0;width:100%;">
          <canvas id="price-chart-canvas" style="width:100%!important;"></canvas>
        </div>
        
        <!-- Price Cards Grid -->
        <div class="price-chart-squares-row" style="margin:0 auto;gap:1.2rem;display:flex;flex-direction:row;justify-content:center;align-items:center;background:none;border:none;box-shadow:none;width:90%;max-width:480px;">
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#00ff88;" id="chart-lvl-usd">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">LVL (USD)</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#00ccff;" id="chart-lvl-pol">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">LVL / POL</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#ff6b6b;" id="chart-pol-usd">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">POL (USD)</span>
          </div>
        </div>
        
        <!-- Chart Controls -->
        <div class="price-chart-controls" style="display:flex;justify-content:center;">
          <div class="price-chart-info">
            <span>آخرین بروزرسانی: <span id="price-chart-last-update">-</span></span>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="price-chart-messages">
          <div class="price-chart-error" id="price-chart-error"></div>
          <div class="price-chart-success" id="price-chart-success"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-container" style="max-width:700px;margin:0.5rem auto 0.5rem auto;">
    <div class="tab-headers" style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
      <div class="dashboard-cards-list">
        <button class="tab-btn list-btn active" id="tab-swap-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">SWAP</button>
        <button class="tab-btn list-btn" id="tab-network-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">NETWORK</button>
        <button class="tab-btn list-btn" id="tab-profile-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">PROFILE</button>
        <button class="tab-btn list-btn" id="tab-reports-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">REPORTS</button>
        <button class="tab-btn list-btn" id="tab-news-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">NEWS</button>
        <button class="tab-btn list-btn" id="tab-shop-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">SHOP</button>
        <a class="tab-btn list-btn" id="tab-lottery-btn" href="lottery.html" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">LOTTERY</a>
        <button class="tab-btn list-btn" id="tab-about-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">ABOUT</button>
        <button class="tab-btn list-btn" id="tab-register-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">REGISTER</button>
      </div>
    </div>
  </div>
  <div id="main-swap" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    <div class="expand-header">
      <h2 class="swap-title">  </h2>
    </div>
    <div class="expand-content">
      <div class="swap-container">
        <form id="swapForm" class="swap-form">
          <label for="swapDirection">نوع تبدیل:</label>
          <select id="swapDirection">
            <option value="matic-to-lvl">POL → LVL</option>
            <option value="lvl-to-matic">LVL → POL</option>
          </select>
          <label for="swapAmount">مقدار:</label>
          <div class="amount-row">
            <input type="number" id="swapAmount" placeholder="مقدار را وارد کنید" step="any" />
            <button type="button" id="maxButton" class="max-btn">حداکثر</button>
          </div>
          <div class="swap-info" id="swapInfo">نرخ تبدیل: -</div>
          <button type="submit" id="swapButton">تبدیل</button>
          <div class="balances">
            <span id="maticBalance">MATIC: -</span> | <span id="lvlBalance">LVL: -</span>
          </div>
          <div class="swap-status" id="swapStatus"></div>
        </form>
        
        <!-- Container برای نمایش قیمت‌های مختلف -->
        <div id="swap-price-info"></div>
      </div>
    </div>
  </div>
  <div id="main-network" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="network-title"></h2>
    </div>
    <div class="expand-content">
      <div class="network-container">
        <!-- کارت اطلاعات کاربر شبکه -->
        <div id="network-user-card" style="background:#101c2c;border-radius:16px;padding:1.5rem 1rem;margin-bottom:2rem;box-shadow:0 2px 12px #0002;max-width:420px;margin-left:auto;margin-right:auto;">
          <div style="display:flex;justify-content:space-between;"><span style="color:#00ff88;">آدرس:</span><span id="user-address" style="direction:ltr;color:#fff;font-weight:bold;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">معرف:</span><span id="user-referrer" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ccff;">موجودی POL:</span><span id="user-pol-balance" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ccff;">موجودی LVL:</span><span id="user-lvl-balance" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">سقف درآمد باینری:</span><span id="user-binary-cap" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">دریافت‌شده:</span><span id="user-claimed" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;align-items:center;"><span style="color:#00ff88;">لینک دعوت:</span><span id="user-ref-link" style="direction:ltr;color:#fff;background:#181c2a;padding:0.3rem 0.7rem;border-radius:8px;">-</span><button id="copy-ref-link" style="margin-right:0.5rem;background:linear-gradient(90deg,#00ff88,#00ccff);color:#000;border:none;border-radius:8px;padding:0.3rem 1.2rem;cursor:pointer;">کپی</button></div>
        </div>
        <!-- نمایش درخت شبکه -->
        <div id="network-tree"></div>
      </div>
      <!-- دکمه ثبت جدید برای حساب فعال در شبکه -->
      <button id="new-register-btn" class="register-btn" style="width: 100%; display: none; margin: 2rem 0;">ثبت جدید</button>
    </div>
  </div>

  <div id="main-profile" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <div class="profile-info">
          <div class="profile-row"><span class="profile-label">آدرس:</span><span class="profile-value" id="profile-address">-</span></div>
          <div class="profile-row"><span class="profile-label">معرف:</span><span class="profile-value" id="profile-referrer">-</span></div>
          <div class="profile-row"><span class="profile-label">موجودی POL:</span><span class="profile-value" id="profile-matic">-</span><span class="profile-value" id="profile-matic-usd"></span></div>
          <div class="profile-row"><span class="profile-label">موجودی LVL:</span><span class="profile-value" id="profile-lvl">-</span><span class="profile-value" id="profile-lvl-usd"></span></div>
          <div class="profile-row"><span class="profile-label">سقف درآمد باینری:</span><span class="profile-value" id="profile-income-cap">-</span></div>
          <div class="profile-row"><span class="profile-label">دریافت‌شده:</span><span class="profile-value" id="profile-received">-</span></div>
          <div class="profile-row"><span class="profile-label">باقیمانده خریدهای قبلی:</span><span class="profile-value" id="profile-purchased-kind">-</span></div>
          <div class="profile-row"><span class="profile-label">درآمد رفرال ثبت‌نام:</span><span class="profile-value" id="profile-refclimed">-</span></div>
          <div class="profile-row"><span class="profile-label">لینک دعوت:</span><span class="profile-value" id="profile-referral-link">-</span><button id="copyProfileReferral" class="copy-btn">کپی</button></div>
          <div class="profile-row"><span class="profile-label">امتیاز چپ:</span><span class="profile-value" id="profile-leftPoints">-</span></div>
          <div class="profile-row"><span class="profile-label">امتیاز راست:</span><span class="profile-value" id="profile-rightPoints">-</span></div>
          <div class="profile-row"><span class="profile-label">آخرین برداشت پاداش:</span><span class="profile-value" id="profile-lastClaimTime">-</span></div>
          <div class="profile-row"><span class="profile-label">آخرین برداشت ماهانه:</span><span class="profile-value" id="profile-lastMonthlyClaim">-</span></div>
          <div class="profile-row"><span class="profile-label">کل سود ماهانه:</span><span class="profile-value" id="profile-totalMonthlyRewarded">-</span></div>
          <div class="profile-row"><span class="profile-label">کل واریزی:</span><span class="profile-value" id="profile-depositedAmount">-</span></div>
        </div>
        
        <!-- دکمه برداشت پاداش‌ها -->
        <div style="margin-top: 1.5rem; text-align: center;">
          <button id="profile-claim-btn" class="register-btn" style="width: 100%; max-width: 300px; margin: 0 auto;">
            💰 برداشت پاداش‌های باینری
          </button>
          <button id="profile-claim-monthly-btn" class="register-btn" style="width: 100%; max-width: 300px; margin: 0.5rem auto 0 auto; background: #a786ff; color: #fff;">
            🗓️ برداشت پاداش ماهانه
          </button>
          <div id="profile-claim-status" class="profile-status" style="margin-top: 0.5rem;"></div>
          <div id="profile-claim-monthly-status" class="profile-status" style="margin-top: 0.5rem;"></div>
        </div>
        
        <div id="profileStatus" class="profile-status"></div>
      </div>
    </div>
  </div>

  <div id="main-reports" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <div class="report-filters">
          <select id="report-type-filter">
            <option value="all">همه گزارشات</option>
            <option value="purchase">خریدها</option>
            <option value="activation">فعال‌سازی‌ها</option>
            <option value="binary">پاداش‌های باینری</option>
            <option value="trading">معاملات</option>
          </select>
          <button id="refresh-reports">به‌روزرسانی</button>
        </div>
        <div id="reports-container">
          <div class="loading-message">در حال بارگذاری گزارشات...</div>
        </div>
      </div>
    </div>
  </div>

  <div id="main-news" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="news-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="news-container">
        <ul class="news-list" id="news-list"></ul>
        <h3 style="color:#a786ff;">آموزش‌های سایت</h3>
        <ul class="tutorial-list" id="tutorial-list"></ul>
      </div>
    </div>
  </div>

  <div id="main-shop" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="shop-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="shop-container">
        <div class="products" id="products-list"></div>
        <div class="shop-status" id="shopStatus"></div>
      </div>
    </div>
  </div>

  <div id="main-about" class="page-section expandable-container" style="display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="about-container">
        <div class="about-content">
          <p>LevelUp یک پلتفرم نوآورانه برای آموزش، سرمایه‌گذاری و کسب درآمد از طریق توکن LVL و شبکه باینری است. هدف ما ایجاد بستری شفاف، سریع و کاربرپسند برای همه علاقه‌مندان به دنیای بلاکچین است.</p>
          
          <div class="about-features">
            <h3>ویژگی‌های کلیدی پلتفرم</h3>
            <ul>
              <li>خرید و فروش توکن LVL</li>
              <li>سیستم پاداش باینری</li>
              <li>فروشگاه محصولات آموزشی</li>
              <li>اخبار و آموزش‌های به‌روز</li>
              <li>امنیت بالا و شفافیت کامل</li>
              <li>پشتیبانی 24/7</li>
            </ul>
          </div>
          
          <div class="about-stats">
            <div class="about-stat">
              <div class="icon">👛</div>
              <div class="number" id="about-wallets-count">-</div>
              <div class="label">تعداد ولت‌های متصل</div>
            </div>
            <div class="about-stat">
              <div class="icon">🚀</div>
              <div class="number">1000+</div>
              <div class="label">کاربر فعال</div>
            </div>
            <div class="about-stat">
              <div class="icon">💰</div>
              <div class="number">$500K+</div>
              <div class="label">حجم معاملات</div>
            </div>
            <div class="about-stat">
              <div class="icon">⭐</div>
              <div class="number">4.9</div>
              <div class="label">امتیاز کاربران</div>
            </div>
            <div class="about-stat">
              <div class="icon">🔒</div>
              <div class="number">100%</div>
              <div class="label">امنیت تضمینی</div>
            </div>
          </div>
          
          <div class="about-contact">
            <h3>ارتباط با ما</h3>
            <p>برای سوالات و پشتیبانی با ما در تماس باشید</p>
            <div class="contact-info">
              <div class="contact-item">
                <span class="icon">📧</span>
                <span class="text">support@levelup.com</span>
              </div>
              <div class="contact-item">
                <span class="icon">📱</span>
                <span class="text">@LevelUp_Support</span>
              </div>
              <div class="contact-item">
                <span class="icon">🌐</span>
                <span class="text">www.levelup.com</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="main-register" class="page-section expandable-container" style="display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <!-- نمایش موجودی کاربر -->
        <div id="user-balance-display" style="background: #181c2a; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; text-align: center; border: 1px solid #a786ff33;">
          <h4 style="color: #a786ff; margin-bottom: 0.5rem;">موجودی شما</h4>
          <div id="user-lvl-balance" style="font-size: 1.2rem; color: #fff; font-weight: bold;">-</div>
          <div id="user-lvl-usd-value" style="font-size: 0.9rem; color: #ccc; margin-top: 0.3rem;">-</div>
        </div>

        <!-- فرم ثبت‌نام برای کاربران جدید -->
        <div id="registration-section">
          <div id="registration-form" style="display: none;">
            <h3 style="color: #a786ff; text-align: center; margin-bottom: 1rem;">ثبت‌نام جدید</h3>
            <div style="display: flex; flex-direction: column; gap: 1rem; align-items: center;">
              <label style="color: #fff; width: 100%; text-align: right;">آدرس معرف:</label>
              <input type="text" id="referrer-address" style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid #a786ff55; background: #232946; color: #fff; font-size: 1rem; direction: ltr;" />
              <label style="color: #fff; width: 100%; text-align: right;">مقدار توکن مورد نیاز:</label>
              <input type="text" id="required-token-amount" readonly style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid #a786ff55; background: #232946; color: #fff; font-size: 1rem; direction: ltr;" />
              <button id="register-btn" class="register-btn" style="width: 100%;">ثبت‌ نام</button>
              <div id="register-status" class="profile-status"></div>
            </div>
          </div>
        </div>
        
        <!-- فرم ارتقا برای کاربران فعال -->
        <div id="upgrade-form" style="display: none;">
          <h3 style="color: #a786ff; text-align: center; margin-bottom: 1rem;">افزایش سقف درآمد</h3>
          <div style="background: #181c2a; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #a786ff33;">
            <div style="margin-bottom: 1rem;">
              <label for="upgrade-amount" style="display: block; margin-bottom: 0.5rem; color: #fff; font-weight: bold;">مقدار LVL برای ارتقا:</label>
              <input 
                type="number" 
                id="upgrade-amount" 
                placeholder="مقدار را وارد کنید" 
                step="1"
                style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid #a786ff55; background: #232946; color: #fff; font-size: 1rem;"
              >
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <span style="color: #fff;">ارزش دلاری:</span>
              <span id="upgrade-usd-value" style="color: #a786ff; font-weight: bold;">-</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="color: #fff;">امتیاز جدید:</span>
              <span id="upgrade-points-gain" style="color: #4caf50; font-weight: bold;">-</span>
            </div>
            <div style="margin-top: 0.8rem; padding: 0.8rem; background: #232946; border-radius: 8px; border-left: 3px solid #a786ff;">
              <small style="color: #ccc; display: block; margin-bottom: 0.3rem;">📊 <strong>نحوه محاسبه امتیاز:</strong></small>
              <small style="color: #ccc; display: block;">• هر 50 دلار خرید = 1 امتیاز جدید</small>
              <small style="color: #ccc; display: block;">• حداکثر 100 امتیاز قابل کسب</small>
              <small style="color: #ccc; display: block;">• امتیازها برای درآمد باینری استفاده می‌شوند</small>
            </div>
          </div>
          <button id="upgrade-btn" class="register-btn" style="width: 100%;" disabled>افزایش سقف</button>
          <div id="upgrade-status" class="profile-status"></div>
        </div>
        
        <span id="register-star" style="display:none;color:#FFC107;font-size:1.5rem;margin-right:1rem;">★</span>
      </div>
    </div>
  </div>

  <!-- دکمه ثبت جدید برای حساب فعال -->
  <button id="new-register-btn" class="register-btn" style="width: 100%; display: none; margin-bottom: 80px;">ثبت جدید  در نزدیکترین جایگاه خالی </button>
  <!-- فرم ثبت‌نام نفر جدید (مخفی) -->
  <div id="new-registration-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:#232946; border-radius:16px; padding:2rem; max-width:400px; margin:auto;">
      <h3 style="color:#a786ff; text-align:center; margin-bottom:1rem;">ثبت‌نام نفر جدید</h3>
      <label style="color:#fff; width:100%; text-align:right;">آدرس نفر جدید:</label>
      <input type="text" id="new-user-address" style="width:100%; padding:0.8rem; border-radius:8px; border:1px solid #a786ff55; background:#181c2a; color:#fff; font-size:1rem; direction:ltr; margin-bottom:1rem;" />
      <label style="color:#fff; width:100%; text-align:right;">آدرس معرف:</label>
      <input type="text" id="new-referrer-address" style="width:100%; padding:0.8rem; border-radius:8px; border:1px solid #a786ff55; background:#181c2a; color:#fff; font-size:1rem; direction:ltr; margin-bottom:1rem;" />
      <button id="submit-new-register" class="register-btn" style="width:100%; margin-bottom:1rem;">ثبت نفر جدید</button>
      <button id="close-new-register" style="width:100%; background:#444; color:#fff; border-radius:8px; padding:0.7rem;">انصراف</button>
      <div id="new-register-status" class="profile-status"></div>
    </div>
  </div>

 

  <footer style="direction:ltr;text-align:left;padding:0.5rem 1rem 0.5rem 0;font-size:0.95rem;color:#aaa;position:fixed;left:0;bottom:0;width:100vw;background:rgba(35,41,70,0.97);z-index:100;text-align:left;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>©  LevelUp Platform. All rights reserved.</div>
      <div style="color:#00ff88;font-weight:bold;font-size:1rem;">صداقت و خدمت با چاشنی بلاکچین</div>
    </div>
  </footer>

  <!-- نمایش وضعیت اتصال -->
  <div id="connection-status" style="
    display: none;
    margin: 0 1rem 1rem 1rem;
    padding: 1rem;
    border-radius: 12px;
    font-family: 'Nazanin', 'B Nazanin', 'BNazanin', Tahoma, Arial, sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
  "></div>

  <!-- سایر اسکریپت‌ها -->
  <script src="js/config.js?v=5.7"></script>
  <script src="js/web3-interactions.js?v=5.7"></script>
  <script src="js/main.js?v=5.7"></script>
  <script src="js/swap.js?v=5.7"></script>
  <script src="js/network.js?v=5.7"></script>
  <script src="js/profile.js?v=5.7"></script>
  <script src="js/reports.js?v=5.7"></script>
  <script src="js/news.js?v=5.7"></script>
  <script src="js/shop.js?v=5.7"></script>
  <script src="js/homepage.js?v=5.7"></script>
  <script src="js/register.js?v=5.7"></script>
  <script src="js/price-chart.js?v=5.7"></script>
  <script>
    // ذخیره تب فعال در localStorage
    function setActiveTab(tab) {
      localStorage.setItem('activeTab', tab);
    }
    // بازیابی تب فعال از localStorage
    document.addEventListener('DOMContentLoaded', function() {
      const savedTab = localStorage.getItem('activeTab');
      if (savedTab) {
        showTab(savedTab);
      }
    });
    // افزودن ذخیره‌سازی به کلیک هر تب
    document.getElementById('tab-swap-btn').onclick = function() { setActiveTab('swap'); showTab('swap'); };
    document.getElementById('tab-network-btn').onclick = function() { setActiveTab('network'); showTab('network'); };
    document.getElementById('tab-profile-btn').onclick = function() { setActiveTab('profile'); showTab('profile'); };
    document.getElementById('tab-reports-btn').onclick = function() { setActiveTab('reports'); showTab('reports'); };
    document.getElementById('tab-news-btn').onclick = function() { setActiveTab('news'); showTab('news'); };
    document.getElementById('tab-shop-btn').onclick = function() { setActiveTab('shop'); showTab('shop'); };
    document.getElementById('tab-about-btn').onclick = function() { setActiveTab('about'); showTab('about'); };
    document.getElementById('tab-register-btn').onclick = function() { setActiveTab('register'); showTab('register'); };
  </script>
  
  <!-- Disable expandable functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remove all expand toggle buttons
        const expandButtons = document.querySelectorAll('.expand-toggle-btn');
        expandButtons.forEach(button => {
            button.style.display = 'none';
        });

        // Ensure all containers are expanded
        const expandableContainers = document.querySelectorAll('.expandable-container');
        expandableContainers.forEach(container => {
            container.classList.remove('collapsed');
            
            // Ensure content is always visible
            const content = container.querySelector('.expand-content');
            if (content) {
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '0.5rem';
                content.style.overflow = 'visible';
                content.style.display = 'block';
            }
            
            // Remove pointer cursor from headers
            const header = container.querySelector('.expand-header');
            if (header) {
                header.style.cursor = 'default';
            }
        });

        // Initialize price chart
        if (typeof window.priceChart !== 'undefined' && typeof window.priceChart.initialize === 'function') {
            window.priceChart.initialize();
        }
    });
  </script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const user = await contract.users(address);
      console.log('totalPurchasedKind:', user.totalPurchasedKind?.toString?.() ?? user.totalPurchasedKind);
    })();
  </script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const events = await contract.queryFilter(contract.filters.PurchaseKind());
      console.log(events);
    })();
  </script>
  <script>
    async function updateAboutWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('about-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('about-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('about-wallets-count').innerText = '-';
      }
    }
    // Hook into tab switching
    const aboutBtn = document.getElementById('tab-about-btn');
    if (aboutBtn) {
      aboutBtn.addEventListener('click', updateAboutWalletsCount);
    }
  </script>
  <script>
    async function updateDashboardWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('dashboard-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('dashboard-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('dashboard-wallets-count').innerText = '-';
      }
    }
    // Update wallets count when dashboard (swap tab) is shown
    const swapBtn = document.getElementById('tab-swap-btn');
    if (swapBtn) {
      swapBtn.addEventListener('click', updateDashboardWalletsCount);
    }
    // Also update on initial load
    document.addEventListener('DOMContentLoaded', updateDashboardWalletsCount);
  </script>
  <script>
    function toggleDashboardChart(chartId, btn) {
      const chartDiv = document.getElementById(chartId);
      if (!chartDiv) return;
      const isOpen = chartDiv.style.display === 'block';
      chartDiv.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? '▼' : '▲';
      // Placeholder: Here you can load/render the chart if needed
    }
  </script>
  <div id="custom-footer-div" style="text-align:center; padding:2rem; color:#00ff88; font-size:1.2rem;">
  <br>  <br>  <br>  <br>  <br>  <br>  <br>
  </div>
  <script>
    window.showTab = async function(tab) {
      const tabs = ['swap','network','profile','reports','news','shop','about','register'];
      tabs.forEach(function(name) {
        document.getElementById('main-' + name).style.display = (name === tab) ? '' : 'none';
        document.getElementById('tab-' + name + '-btn').classList.toggle('active', name === tab);
      });
      try {
        switch(tab) {
          case 'swap': break;
          case 'network':
            if (typeof window.initializeNetworkTab === 'function') {
              await window.initializeNetworkTab();
            } else {
              if (typeof updateNetworkStats === 'function') await updateNetworkStats();
              if (typeof renderNetworkTree === 'function') await renderNetworkTree();
            }
            break;
          case 'profile':
            if (typeof loadUserProfile === 'function') await loadUserProfile();
            break;
          case 'reports':
            if (typeof loadReports === 'function') await loadReports();
            break;
          case 'news':
            if (typeof loadNews === 'function') loadNews();
            if (typeof loadTutorials === 'function') loadTutorials();
            break;
          case 'shop':
            if (typeof loadProducts === 'function') loadProducts();
            break;
          case 'about': break;
          case 'register':
            if (typeof window.setRegisterTabSelected === 'function') window.setRegisterTabSelected(true);
            if (typeof loadRegisterData === 'function') await loadRegisterData();
            break;
        }
      } catch (error) {
        console.error(`Error loading data for tab ${tab}:`, error);
      }
    }
  </script>
</body>
</html>
