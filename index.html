<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>پلتفرم LevelUp | داشبورد </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- بارگذاری ethers.js نسخه 6 از CDN -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
    <!-- بارگذاری WalletConnect Provider از CDN رسمی -->
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <!-- بارگذاری WalletConnect Handler -->
    <script src="js/walletconnect-handler.js?v=5.7"></script>

  <!-- بارگذاری WalletConnect UMD به صورت لوکال -->
  <script src="js/walletconnect-v1.8.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
</head>
<body>
  <a href="https://levelupwithus.netlify.app/" target="_blank" style="position:fixed;top:18px;left:24px;z-index:2000;display:flex;align-items:center;text-decoration:none;">
    <img src="lvl.jpg" alt="LVL Logo" style="height:48px;width:auto;border-radius:16px;box-shadow:0 2px 12px #00ff8840;transition:transform 0.2s;">
  </a>

  <div id="main-dashboard" class="page-section expandable-container">
    <div class="expand-header">
      <header>
        <h1 class="shimmer-title" style="font-family: 'Montserrat', sans-serif; font-size:2.5rem; letter-spacing:0.12em; color:#222; text-transform:uppercase; font-weight:700; text-shadow:0 2px 12px #00ff8840, 0 1px 0 #fff;">LEVELUP DASHBOARD</h1>
      
      </header>
    </div>
    <div class="expand-content">
      <div class="dashboard-cards" style="display:flex;justify-content:center;flex-wrap:wrap;gap:1rem;max-width:1200px;margin:0 auto;">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">👛</div>
          <div class="dashboard-card-content">
            <div id="dashboard-wallets-count">-WALLET</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">ALL WALLETS</h4>
          </div>
        </div>

        <!-- حذف کارت قیمت LVL (USD) -->
        <!-- حذف کارت قیمت LVL (POL) -->
        <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="circulating-supply">-LVL</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">TOTAL SUPPLY</h4>
      </div>
    </div>
    <!-- کارت total-users (کاربران) حذف شد -->
            <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="total-points">-POINT</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">TOTAL POINTS</h4>
      </div>
    </div>
    <div class="dashboard-card">
          <div class="dashboard-card-icon"></div>
          <div class="dashboard-card-content">
            <div id="point-value">-LVL</div>
            <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">POINT VALUE</h4>
      </div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-card-icon"></div>
      <div class="dashboard-card-content">
        <div id="contract-token-balance">-LVL</div>
        <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">LVL BALANCE</h4>
      </div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-card-icon"></div>
      <div class="dashboard-card-content">
        <div id="reward-pool">-POL</div>
        <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">POL BALANCE</h4>
      </div>
    </div>
    <div class="dashboard-card" id="dashboard-cashback-card">
      <div class="dashboard-card-icon"></div>
      <div class="dashboard-card-content">
        <div id="dashboard-cashback-value">-</div>
        <h4 style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;text-transform:uppercase;font-size:1.1rem;">HELP FUND</h4>
      </div>
    </div>
      </div>
    </div>
  </div>

  <!-- Price Chart Section -->
  <div id="price-chart-section" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    <div class="expand-header" style="padding:0 1.5rem;">
      <h2 style="margin:0 0 0.5rem 0;">📈 چارت قیمت‌ها</h2>
      <p style="margin:0 0 0.5rem 0;">نمایش لحظه‌ای قیمت‌های توکن LVL، POL و نرخ تبدیل</p>
    </div>
    <div class="expand-content" style="padding:0;">
      <div class="price-chart-container" style="padding:0;width:100%;">
        <!-- Time Period Filters -->
        <div class="price-chart-time-filters-container" style="margin:0 0 0.5rem 0;">
          <div class="price-chart-time-filters" id="price-chart-time-filters" style="gap:0.2rem;">
            <!-- Time period buttons will be added here by JavaScript -->
          </div>
        </div>
        
        <!-- Line Chart Canvas -->
        <div class="price-chart-canvas-container" style="margin:0;min-width:0;width:100%;">
          <canvas id="price-chart-canvas" style="width:100%!important;"></canvas>
        </div>
        
        <!-- Price Cards Grid -->
        <div class="price-chart-squares-row" style="margin:0 auto;gap:1.2rem;display:flex;flex-direction:row;justify-content:center;align-items:center;background:none;border:none;box-shadow:none;width:90%;max-width:480px;">
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#00ff88;" id="chart-lvl-usd">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">LVL (USD)</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#00ccff;" id="chart-lvl-pol">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">LVL / POL</span>
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;font-size:1.1rem;flex:1;min-width:120px;text-align:center;padding:0.7rem 1.2rem;background:#181c2a;border-radius:16px;box-shadow:0 2px 8px #0002;">
            <span style="font-weight:bold;color:#ff6b6b;" id="chart-pol-usd">-</span>
            <span style="color:#00ccff;font-size:0.95rem;">POL (USD)</span>
          </div>
        </div>
        
        <!-- Chart Controls -->
        <div class="price-chart-controls" style="display:flex;justify-content:center;">
          <div class="price-chart-info">
            <span>آخرین بروزرسانی: <span id="price-chart-last-update">-</span></span>
          </div>
        </div>
        
        <!-- Messages -->
        <div class="price-chart-messages">
          <div class="price-chart-error" id="price-chart-error"></div>
          <div class="price-chart-success" id="price-chart-success"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-container" style="max-width:700px;margin:0.5rem auto 0.5rem auto;">
    <div class="tab-headers" style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
      <div class="dashboard-cards-list">
        <button class="tab-btn list-btn active" id="tab-swap-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">SWAP</button>
        <button class="tab-btn list-btn" id="tab-network-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">NETWORK</button>
        <button class="tab-btn list-btn" id="tab-profile-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">PROFILE</button>
        <button class="tab-btn list-btn" id="tab-reports-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">REPORTS</button>
        <a class="tab-btn list-btn" id="tab-news-btn" href="news.html" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">NEWS</a>
        <a class="tab-btn list-btn" id="tab-shop-btn" href="shop.html" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">SHOP</a>
        <a class="tab-btn list-btn" id="tab-learning-btn" href="learning.html" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">LEARNING</a>
        <a class="tab-btn list-btn" id="tab-lottery-btn" href="lottery.html" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">LOTTERY</a>
        <button class="tab-btn list-btn" id="tab-about-btn" type="button" style="font-family:'Montserrat',sans-serif;letter-spacing:0.04em;">ABOUT</button>
      </div>
    </div>
  </div>
  <div id="main-swap" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;">
    <div class="expand-header">
      <h2 class="swap-title">  </h2>
    </div>
    <div class="expand-content">
      <div class="swap-container">
        <form id="swapForm" class="swap-form">
          <label for="swapDirection">نوع تبدیل:</label>
          <select id="swapDirection">
            <option value="matic-to-lvl">POL → LVL</option>
            <option value="lvl-to-matic">LVL → POL</option>
          </select>
          <label for="swapAmount">مقدار:</label>
          <div class="amount-row">
            <input type="number" id="swapAmount" placeholder="مقدار را وارد کنید" step="any" />
            <button type="button" id="maxButton" class="max-btn">حداکثر</button>
          </div>
          <div class="swap-info" id="swapInfo">نرخ تبدیل: -</div>
          <button type="submit" id="swapButton">تبدیل</button>
          <div class="balances">
            <span id="maticBalance">MATIC: -</span> | <span id="lvlBalance">LVL: -</span>
          </div>
          <div class="swap-status" id="swapStatus"></div>
        </form>
        
        <!-- Container برای نمایش قیمت‌های مختلف -->
        <div id="swap-price-info"></div>
      </div>
    </div>
  </div>
  <div id="main-network" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="network-title"></h2>
    </div>
    <div class="expand-content">
      <div class="network-container">
        <!-- کارت اطلاعات کاربر شبکه -->
        <div id="network-user-card" style="background:#101c2c;border-radius:16px;padding:1.5rem 1rem;margin-bottom:2rem;box-shadow:0 2px 12px #0002;max-width:420px;margin-left:auto;margin-right:auto;">
          <div style="display:flex;justify-content:space-between;"><span style="color:#00ff88;">آدرس:</span><span id="user-address" style="direction:ltr;color:#fff;font-weight:bold;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">معرف:</span><span id="user-referrer" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ccff;">موجودی POL:</span><span id="user-pol-balance" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ccff;">موجودی LVL:</span><span id="user-lvl-balance" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">سقف درآمد باینری:</span><span id="user-binary-cap" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;"><span style="color:#00ff88;">دریافت‌شده:</span><span id="user-claimed" style="color:#fff;">-</span></div>
          <div style="display:flex;justify-content:space-between;margin-top:0.7rem;align-items:center;"><span style="color:#00ff88;">لینک دعوت:</span><span id="user-ref-link" style="direction:ltr;color:#fff;background:#181c2a;padding:0.3rem 0.7rem;border-radius:8px;">-</span><button id="copy-ref-link" style="margin-right:0.5rem;background:linear-gradient(90deg,#00ff88,#00ccff);color:#000;border:none;border-radius:8px;padding:0.3rem 1.2rem;cursor:pointer;">کپی</button></div>
        </div>
        <!-- نمایش درخت شبکه -->
        <div id="network-tree"></div>
      </div>
      <!-- دکمه ثبت جدید برای حساب فعال در شبکه -->
      <button id="new-register-btn" class="register-btn" style="width: 100%; display: none; margin: 2rem 0;">ثبت جدید</button>
    </div>
  </div>

  <div id="main-profile" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <div class="profile-info">
          <div class="profile-row"><span class="profile-label">آدرس:</span><span class="profile-value" id="profile-address">-</span></div>
          <div class="profile-row"><span class="profile-label">معرف:</span><span class="profile-value" id="profile-referrer">-</span></div>
          <div class="profile-row"><span class="profile-label">موجودی POL:</span><span class="profile-value" id="profile-matic">-</span><span class="profile-value" id="profile-matic-usd"></span></div>
          <div class="profile-row"><span class="profile-label">موجودی LVL:</span><span class="profile-value" id="profile-lvl">-</span><span class="profile-value" id="profile-lvl-usd"></span></div>
          <div class="profile-row"><span class="profile-label">سقف درآمد باینری:</span><span class="profile-value" id="profile-income-cap">-</span></div>
          <div class="profile-row"><span class="profile-label">دریافت‌شده:</span><span class="profile-value" id="profile-received">-</span></div>
          <div class="profile-row"><span class="profile-label">باقیمانده خریدهای قبلی:</span><span class="profile-value" id="profile-purchased-kind">-</span></div>
          <div class="profile-row"><span class="profile-label">درآمد رفرال ثبت‌نام:</span><span class="profile-value" id="profile-refclimed">-</span></div>
          <div class="profile-row"><span class="profile-label">لینک دعوت:</span><span class="profile-value" id="profile-referral-link">-</span><button id="copyProfileReferral" class="copy-btn">کپی</button></div>
          <div class="profile-row"><span class="profile-label">امتیاز چپ:</span><span class="profile-value" id="profile-leftPoints">-</span></div>
          <div class="profile-row"><span class="profile-label">امتیاز راست:</span><span class="profile-value" id="profile-rightPoints">-</span></div>
          <div class="profile-row"><span class="profile-label">آخرین برداشت پاداش:</span><span class="profile-value" id="profile-lastClaimTime">-</span></div>
          <div class="profile-row"><span class="profile-label">آخرین برداشت ماهانه:</span><span class="profile-value" id="profile-lastMonthlyClaim">-</span></div>
          <div class="profile-row"><span class="profile-label">کل سود ماهانه:</span><span class="profile-value" id="profile-totalMonthlyRewarded">-</span></div>
          <div class="profile-row"><span class="profile-label">کل واریزی:</span><span class="profile-value" id="profile-depositedAmount">-</span></div>
        </div>
        
        <!-- دکمه برداشت پاداش‌ها -->
        <div style="margin-top: 1.5rem; text-align: center;">
          <button id="profile-claim-btn" class="register-btn" style="width: 100%; max-width: 300px; margin: 0 auto;">
            💰 برداشت پاداش‌های باینری
          </button>
          <button id="profile-claim-monthly-btn" class="register-btn" style="width: 100%; max-width: 300px; margin: 0.5rem auto 0 auto; background: #a786ff; color: #fff;">
            🗓️ برداشت پاداش ماهانه
          </button>
          <div id="profile-claim-status" class="profile-status" style="margin-top: 0.5rem;"></div>
          <div id="profile-claim-monthly-status" class="profile-status" style="margin-top: 0.5rem;"></div>
        </div>
        
        <div id="profileStatus" class="profile-status"></div>
      </div>
    </div>
  </div>

  <div id="main-reports" class="page-section expandable-container" style="width:100vw;max-width:none;margin:0;left:0;right:0;padding:0.5rem 0;display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="profile-container">
        <div class="report-filters">
          <select id="report-type-filter">
            <option value="all">همه گزارشات</option>
            <option value="purchase">خریدها</option>
            <option value="activation">فعال‌سازی‌ها</option>
            <option value="binary">پاداش‌های باینری</option>
            <option value="trading">معاملات</option>
          </select>
          <button id="refresh-reports">به‌روزرسانی</button>
        </div>
        <div id="reports-container">
          <div class="loading-message">در حال بارگذاری گزارشات...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- NEWS section moved to news.html -->

  <!-- SHOP section moved to shop.html -->

  <div id="main-about" class="page-section expandable-container" style="display:none;">
    <div class="expand-header">
      <h2 class="profile-title"> </h2>
    </div>
    <div class="expand-content">
      <div class="about-container">
        <div class="about-content">
          <p>LevelUp یک پلتفرم نوآورانه برای آموزش، سرمایه‌گذاری و کسب درآمد از طریق توکن LVL و شبکه باینری است. هدف ما ایجاد بستری شفاف، سریع و کاربرپسند برای همه علاقه‌مندان به دنیای بلاکچین است.</p>
          
          <div class="about-features">
            <h3>ویژگی‌های کلیدی پلتفرم</h3>
            <ul>
              <li>خرید و فروش توکن LVL</li>
              <li>سیستم پاداش باینری</li>
              <li>فروشگاه محصولات آموزشی</li>
              <li>اخبار و آموزش‌های به‌روز</li>
              <li>امنیت بالا و شفافیت کامل</li>
              <li>پشتیبانی 24/7</li>
            </ul>
          </div>
          
          <div class="about-stats">
            <div class="about-stat">
              <div class="icon">👛</div>
              <div class="number" id="about-wallets-count">-</div>
              <div class="label">تعداد ولت‌های متصل</div>
            </div>
            <div class="about-stat">
              <div class="icon">🚀</div>
              <div class="number">1000+</div>
              <div class="label">کاربر فعال</div>
            </div>
            <div class="about-stat">
              <div class="icon">💰</div>
              <div class="number">$500K+</div>
              <div class="label">حجم معاملات</div>
            </div>
            <div class="about-stat">
              <div class="icon">⭐</div>
              <div class="number">4.9</div>
              <div class="label">امتیاز کاربران</div>
            </div>
            <div class="about-stat">
              <div class="icon">🔒</div>
              <div class="number">100%</div>
              <div class="label">امنیت تضمینی</div>
            </div>
          </div>
          
          <div class="about-contact">
            <h3>ارتباط با ما</h3>
            <p>برای سوالات و پشتیبانی با ما در تماس باشید</p>
            <div class="contact-info">
              <div class="contact-item">
                <span class="icon">📧</span>
                <span class="text">support@levelup.com</span>
              </div>
              <div class="contact-item">
                <span class="icon">📱</span>
                <span class="text">@LevelUp_Support</span>
              </div>
              <div class="contact-item">
                <span class="icon">🌐</span>
                <span class="text">www.levelup.com</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer style="direction:ltr;text-align:left;padding:0.5rem 1rem 0.5rem 0;font-size:0.95rem;color:#aaa;position:fixed;left:0;bottom:0;width:100vw;background:rgba(35,41,70,0.97);z-index:100;text-align:left;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>©  LevelUp Platform. All rights reserved.</div>
      <div style="color:#aaa;font-size:0.95rem;">Honesty and Service with a Touch of Blockchain</div>
    </div>
  </footer>

  <!-- نمایش وضعیت اتصال -->
  <div id="connection-status" style="
    display: none;
    margin: 0 1rem 1rem 1rem;
    padding: 1rem;
    border-radius: 12px;
    font-family: 'Nazanin', 'B Nazanin', 'BNazanin', Tahoma, Arial, sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
  "></div>

  <!-- سایر اسکریپت‌ها -->
  <script src="js/config.js?v=5.7"></script>
  <script src="js/web3-interactions.js?v=5.7"></script>
  <script src="js/main.js?v=5.7"></script>
  <script src="js/swap.js?v=5.7"></script>
  <script src="js/network.js?v=5.7"></script>
  <script src="js/profile.js?v=5.7"></script>
  <script src="js/reports.js?v=5.7"></script>
  <script src="js/news.js?v=5.7"></script>
  <script src="js/shop.js?v=5.7"></script>
  <script src="js/learning.js?v=5.7"></script>
  <script src="js/homepage.js?v=5.7"></script>
  <script src="js/price-chart.js?v=5.7"></script>
  <script>
    // ذخیره تب فعال در localStorage
    function setActiveTab(tab) {
      localStorage.setItem('activeTab', tab);
    }
    // بازیابی تب فعال از localStorage
    document.addEventListener('DOMContentLoaded', function() {
      const savedTab = localStorage.getItem('activeTab');
      if (savedTab) {
        showTab(savedTab);
      }
    });
    // افزودن ذخیره‌سازی به کلیک هر تب
    document.getElementById('tab-swap-btn').onclick = function() { setActiveTab('swap'); showTab('swap'); };
    document.getElementById('tab-network-btn').onclick = function() { setActiveTab('network'); showTab('network'); };
    document.getElementById('tab-profile-btn').onclick = function() { setActiveTab('profile'); showTab('profile'); };
    document.getElementById('tab-reports-btn').onclick = function() { setActiveTab('reports'); showTab('reports'); };
    // NEWS and SHOP are now separate pages - no event listeners needed
    document.getElementById('tab-learning-btn').onclick = function() { setActiveTab('learning'); showTab('learning'); };
    document.getElementById('tab-about-btn').onclick = function() { setActiveTab('about'); showTab('about'); };
  </script>
  
  <!-- Disable expandable functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remove all expand toggle buttons
        const expandButtons = document.querySelectorAll('.expand-toggle-btn');
        expandButtons.forEach(button => {
            button.style.display = 'none';
        });

        // Ensure all containers are expanded
        const expandableContainers = document.querySelectorAll('.expandable-container');
        expandableContainers.forEach(container => {
            container.classList.remove('collapsed');
            
            // Ensure content is always visible
            const content = container.querySelector('.expand-content');
            if (content) {
                content.style.maxHeight = 'none';
                content.style.opacity = '1';
                content.style.padding = '0.5rem';
                content.style.overflow = 'visible';
                content.style.display = 'block';
            }
            
            // Remove pointer cursor from headers
            const header = container.querySelector('.expand-header');
            if (header) {
                header.style.cursor = 'default';
            }
        });

        // Initialize price chart
        if (typeof window.priceChart !== 'undefined' && typeof window.priceChart.initialize === 'function') {
            window.priceChart.initialize();
        }
    });
  </script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const user = await contract.users(address);
      console.log('totalPurchasedKind:', user.totalPurchasedKind?.toString?.() ?? user.totalPurchasedKind);
    })();
  </script>
  <script>
    (async () => {
      const { contract, address } = await window.connectWallet();
      const events = await contract.queryFilter(contract.filters.PurchaseKind());
      console.log(events);
    })();
  </script>
  <script>
    async function updateAboutWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('about-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('about-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('about-wallets-count').innerText = '-';
      }
    }
    // Hook into tab switching
    const aboutBtn = document.getElementById('tab-about-btn');
    if (aboutBtn) {
      aboutBtn.addEventListener('click', updateAboutWalletsCount);
    }
  </script>
  <script>
    async function updateDashboardWalletsCount() {
      try {
        if (!window.contractConfig || !window.contractConfig.contract) {
          await window.connectWallet();
        }
        const contract = window.contractConfig.contract;
        if (contract && contract.wallets) {
          const walletsCount = await contract.wallets();
          document.getElementById('dashboard-wallets-count').innerText = walletsCount.toString();
        } else {
          document.getElementById('dashboard-wallets-count').innerText = '-';
        }
      } catch (e) {
        document.getElementById('dashboard-wallets-count').innerText = '-';
      }
    }
    // Update wallets count when dashboard (swap tab) is shown
    const swapBtn = document.getElementById('tab-swap-btn');
    if (swapBtn) {
      swapBtn.addEventListener('click', updateDashboardWalletsCount);
    }
    // Also update on initial load
    document.addEventListener('DOMContentLoaded', updateDashboardWalletsCount);
  </script>
  <script>
    function toggleDashboardChart(chartId, btn) {
      const chartDiv = document.getElementById(chartId);
      if (!chartDiv) return;
      const isOpen = chartDiv.style.display === 'block';
      chartDiv.style.display = isOpen ? 'none' : 'block';
      btn.textContent = isOpen ? '▼' : '▲';
      // Placeholder: Here you can load/render the chart if needed
    }
  </script>
  <!-- مودال افزودن/ویرایش ساب ادمین -->
  <div class="sub-admin-modal" id="sub-admin-modal">
    <div class="sub-admin-modal-content">
      <h3 id="modal-title">افزودن ساب ادمین جدید</h3>
      <form class="sub-admin-form" id="sub-admin-form">
        <div class="form-group">
          <label for="sub-admin-name">نام ساب ادمین:</label>
          <input type="text" id="sub-admin-name" placeholder="نام کامل ساب ادمین" required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-address">آدرس کیف پول:</label>
          <input type="text" id="sub-admin-address" placeholder="0x..." required>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-role">نقش:</label>
          <select id="sub-admin-role" required>
            <option value="">انتخاب نقش</option>
            <option value="moderator">مدیر محتوا</option>
            <option value="support">پشتیبانی</option>
            <option value="analyst">تحلیلگر</option>
            <option value="teacher">مدرس</option>
            <option value="custom">سفارشی</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="sub-admin-description">توضیحات:</label>
          <textarea id="sub-admin-description" placeholder="توضیحات اضافی..." rows="3"></textarea>
        </div>
        
        <div class="permissions-group">
          <h5>🔐 دسترسی‌های ساب ادمین</h5>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-stream-control" name="permissions">
            <label for="perm-stream-control">کنترل لایو استریم</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-chat-moderate" name="permissions">
            <label for="perm-chat-moderate">مدیریت چت</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-ban-users" name="permissions">
            <label for="perm-ban-users">مسدود کردن کاربران</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-reports" name="permissions">
            <label for="perm-view-reports">مشاهده گزارش‌ها</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-manage-content" name="permissions">
            <label for="perm-manage-content">مدیریت محتوا</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-analytics" name="permissions">
            <label for="perm-view-analytics">مشاهده آمار</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-edit-products" name="permissions">
            <label for="perm-edit-products">ویرایش محصولات</label>
          </div>
          
          <div class="permission-item">
            <input type="checkbox" id="perm-view-orders" name="permissions">
            <label for="perm-view-orders">مشاهده سفارشات</label>
          </div>
        </div>
        
        <div class="modal-buttons">
          <button type="submit" class="modal-btn primary" id="save-sub-admin-btn">💾 ذخیره</button>
          <button type="button" class="modal-btn secondary" id="cancel-sub-admin-btn">❌ انصراف</button>
        </div>
      </form>
    </div>
  </div>

  <!-- مودال تأیید حذف -->
  <div class="sub-admin-modal" id="delete-confirm-modal">
    <div class="sub-admin-modal-content">
      <h3>⚠️ تأیید حذف</h3>
      <p style="color: #ccc; text-align: center; margin-bottom: 1.5rem;">
        آیا مطمئن هستید که می‌خواهید این ساب ادمین را حذف کنید؟
      </p>
      <div style="background: #181c2a; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
        <p style="color: #fff; margin: 0;"><strong>نام:</strong> <span id="delete-admin-name"></span></p>
        <p style="color: #888; margin: 0.5rem 0 0 0;"><strong>آدرس:</strong> <span id="delete-admin-address"></span></p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn danger" id="confirm-delete-btn">🗑️ حذف</button>
        <button class="modal-btn secondary" id="cancel-delete-btn">❌ انصراف</button>
      </div>
    </div>
  </div>

  <div id="custom-footer-div" style="text-align:center; padding:2rem; color:#00ff88; font-size:1.2rem;">
  <br>  <br>  <br>  <br>  <br>  <br>  <br>
  </div>
  <script>
    window.showTab = async function(tab) {
      const tabs = ['swap','network','profile','reports','news','shop','learning','about'];
      tabs.forEach(function(name) {
        var mainEl = document.getElementById('main-' + name);
        if (mainEl) mainEl.style.display = (name === tab) ? '' : 'none';
        var btnEl = document.getElementById('tab-' + name + '-btn');
        if (btnEl) btnEl.classList.toggle('active', name === tab);
      });
      try {
        switch(tab) {
          case 'swap': break;
          case 'network':
            if (typeof window.initializeNetworkTab === 'function') {
              await window.initializeNetworkTab();
            } else {
              if (typeof updateNetworkStats === 'function') await updateNetworkStats();
              if (typeof renderNetworkTree === 'function') await renderNetworkTree();
            }
            break;
          case 'profile':
            if (typeof loadUserProfile === 'function') await loadUserProfile();
            break;
          case 'reports':
            if (typeof loadReports === 'function') await loadReports();
            break;
          case 'news':
            if (typeof loadNews === 'function') loadNews();
            if (typeof loadTutorials === 'function') loadTutorials();
            break;
          case 'shop':
            if (typeof loadProducts === 'function') loadProducts();
            break;
          case 'learning':
            if (typeof initializeLearningTab === 'function') initializeLearningTab();
            break;
          case 'about': break;
        }
      } catch (error) {
        console.error(`Error loading data for tab ${tab}:`, error);
      }
    }
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var archiveBtn = Array.from(document.querySelectorAll('button, a')).find(el => el.textContent.includes('آرشیو بازارهای مالی'));
      if (archiveBtn) archiveBtn.remove();
    });
  </script>

  <script>
  (async function() {
    if (window.getUserProfile) {
      const profile = await window.getUserProfile();
      if (!profile.activated) {
        // قفل کردن فقط بخش ریپورت
        const reportsSection = document.getElementById('main-reports');
        if (reportsSection) {
          reportsSection.innerHTML = '<div style="color:#ff6b6b;text-align:center;padding:3rem;font-size:1.5rem;">دسترسی به این بخش فقط برای کاربران فعال مجاز است.<br>🔒</div>';
          reportsSection.style.background = '#181c2a';
        }
      }
    }
  })();
  </script>

</body>
</html>
